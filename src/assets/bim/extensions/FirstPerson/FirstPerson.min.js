/*!
 * LMV v7.11.0
 * 
 * Copyright 2020 Autodesk, Inc.
 * All rights reserved.
 * 
 * This computer source code and related instructions and comments are the
 * unpublished confidential and proprietary information of Autodesk, Inc.
 * and are protected under Federal copyright and state trade secret law.
 * They may not be disclosed to, copied or used by any third party without
 * the prior written consent of Autodesk, Inc.
 * 
 * Autodesk Forge Viewer Usage Limitations:
 * 
 * The Autodesk Forge viewer can only be used to view files generated by
 * Autodesk Forge services. The Autodesk Forge Viewer JavaScript must be
 * delivered from an Autodesk hosted URL.
 */
Autodesk.Extensions.FirstPerson=function(e){var t={};function a(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,a),o.l=!0,o.exports}return a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)a.d(n,o,function(t){return e[t]}.bind(null,o));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=559)}({559:function(e,t,a){"use strict";function n(e){var t,a,n,o,i,r,s,u,l,c,T=Autodesk.Viewing.Private,d=e.navigation,g=e.container,h=d.getCamera(),p=1,v=.1,f=6,A={},E=new THREE.Clock(!0),S={seedURN:!1,objectSet:!0,viewport:!0,renderOptions:{environment:!1,ambientOcclusion:!1,toneMap:{exposure:!1},appearance:!1}},R={SOUTH_BTN:0,EAST_BTN:1,WEST_BTN:2,NORTH_BTN:3,LEFT_SHOULDER:4,RIGHT_SHOULDER:5,LEFT_TRIGGER:6,RIGHT_TRIGGER:7,SOUTH_DPAD:13,EAST_DPAD:15,WEST_DPAD:14,NORTH_DPAD:12,LEFT_STICK_BUTTON:10,RIGHT_STICK_BUTTON:11},I={LEFT_STICK_X:0,LEFT_STICK_Y:1,RIGHT_STICK_X:2,RIGHT_STICK_Y:3},_=function(){},m={};for(var b in R)R.hasOwnProperty(b)&&(m[R[b]]=_);this.activate=function(a){var n=e.model.getBoundingBox().size();p=Math.max(Math.min(Math.min(n.x,n.y),n.z)/10,1e-4),t=navigator.getGamepads()[0],o=new Autodesk.Viewing.Private.ViewerState(e),i=[],r=0,c=a,C(a)},this.deactivate=function(){c=null,o=null},this.update=function(e,o){(o&&(h=o),e=E.getDelta(),t=navigator.getGamepads()[0],a>-1)&&((new Date).getTime()-a>n&&O());if(t&&(u=2*e*p*f,h.isPerspective||d.toPerspective(),t&&function(){for(var e in m)if(m.hasOwnProperty(e)&&t.buttons[e].pressed&&.5!=t.buttons[e].value)return A[e]=!0,!0;for(var e in A)if(A.hasOwnProperty(e)&&A[e])return!0;return!(Math.abs(t.axes[I.LEFT_STICK_X])<v&&Math.abs(t.axes[I.LEFT_STICK_Y])<v&&Math.abs(t.axes[I.RIGHT_STICK_X])<v&&Math.abs(t.axes[I.RIGHT_STICK_Y])<v)}())){h.dirty=!0,s&&(l=h.position.z);var i=h.target.clone().sub(h.position),r=i.length();i.multiplyScalar(1/r);var c=i.clone().cross(h.up).normalize();if(Math.abs(t.axes[I.LEFT_STICK_Y])>v){var T=i.clone().multiplyScalar(-t.axes[I.LEFT_STICK_Y]*u);h.position.add(T),h.target.add(T)}if(Math.abs(t.axes[I.LEFT_STICK_X])>v){var g=c.clone().multiplyScalar(t.axes[I.LEFT_STICK_X]*u);h.position.add(g),h.target.add(g)}var S=new THREE.Quaternion,_=i;if(Math.abs(t.axes[I.RIGHT_STICK_Y])>v){var b=h.clone(),H=i.clone();S.setFromAxisAngle(c,-t.axes[I.RIGHT_STICK_Y]*u/2),H.applyQuaternion(S),b.up.applyQuaternion(S);var C=b.worldup.clone(),w=H.angleTo(C),k=THREE.Math.degToRad(5);w>=k&&w<=Math.PI-k&&(_=i.clone().applyQuaternion(S),h.up.applyQuaternion(S))}var G=new THREE.Quaternion;Math.abs(t.axes[I.RIGHT_STICK_X])>v&&(G.setFromAxisAngle(h.worldup,-t.axes[I.RIGHT_STICK_X]*u/2),_.applyQuaternion(G),h.up.applyQuaternion(G)),function(){for(var e in R)R.hasOwnProperty(e)&&P(R[e])}(),s&&(h.position.z=l),_.multiplyScalar(r),h.target.copy(h.position).add(_)}return h};var O=function(){Autodesk.Viewing.Private.HudMessage.dismiss(),a=-1},H=function(e){var t;switch(O(),e){case"up":t=s?"Vertical Lock Mode":"Fly mode"}!function(e,t,o,i,r){Autodesk.Viewing.Private.HudMessage.displayMessage(g,e,o,i,r),t>0?(a=(new Date).getTime(),n=t):(a=-1,n=0)}({msgTitleKey:"View Orientation Drag Mode Toggled",messageKey:"View Orientation Drag Mode Toggled",messageDefaultValue:t},2e3)};function P(e){if(t.buttons[e].value>v)switch(A[e]=!0,e){case R.LEFT_SHOULDER:case R.RIGHT_SHOULDER:m[e]();break;case R.LEFT_TRIGGER:m[e](t.buttons[R.LEFT_TRIGGER].value);break;case R.RIGHT_TRIGGER:m[e](t.buttons[R.RIGHT_TRIGGER].value)}else if(A[e])switch(A[e]=!1,e){case R.SOUTH_BTN:case R.EAST_BTN:case R.WEST_BTN:case R.NORTH_BTN:case R.NORTH_DPAD:case R.SOUTH_DPAD:case R.WEST_DPAD:case R.EAST_DPAD:case R.RIGHT_STICK_BUTTON:case R.LEFT_STICK_BUTTON:m[e]();break;case R.LEFT_TRIGGER:m[e](t.buttons[R.LEFT_TRIGGER].value);break;case R.RIGHT_TRIGGER:m[e](t.buttons[R.RIGHT_TRIGGER].value)}}var C=function(e){switch(e){case"headtracker":m[R.SOUTH_BTN]=V,m[R.SOUTH_DPAD]=w,m[R.NORTH_DPAD]=Y,m[R.WEST_BTN]=M,m[R.LEFT_SHOULDER]=k,m[R.RIGHT_SHOULDER]=G,m[R.LEFT_TRIGGER]=D,m[R.RIGHT_TRIGGER]=F,m[R.RIGHT_STICK_BUTTON]=x,m[R.LEFT_STICK_BUTTON]=B;break;default:m[R.SOUTH_BTN]=V,m[R.EAST_BTN]=L,m[R.WEST_BTN]=M,m[R.NORTH_BTN]=K,m[R.SOUTH_DPAD]=w,m[R.WEST_DPAD]=N,m[R.EAST_DPAD]=U,m[R.NORTH_DPAD]=Y,m[R.LEFT_SHOULDER]=k,m[R.RIGHT_SHOULDER]=G,m[R.LEFT_TRIGGER]=y,m[R.RIGHT_TRIGGER]=F,m[R.RIGHT_STICK_BUTTON]=x,m[R.LEFT_STICK_BUTTON]=B}},w=function(){e.navigation.setRequestHomeView(!0),e.showAll(),e.impl.selector.clearSelection(),e.explode(0)},k=function(){s?l+=-t.buttons[R.LEFT_SHOULDER].pressed*u:h.translateY(-t.buttons[R.LEFT_SHOULDER].pressed*u)},G=function(){s?l+=t.buttons[R.RIGHT_SHOULDER].pressed*u:h.translateY(t.buttons[R.RIGHT_SHOULDER].pressed*u)},D=function(t){if(t>v){if(.5==t)return void e.explode(0);var a=t;a>1&&(a=1),a<0&&(a=0),e.explode(a)}else e.explode(0)},y=function(e){if(e>v){if(.5==e)return h.fov=75,void(A[R.LEFT_TRIGGER]=!1);h.fov=-45*e+75}else h.fov=75},F=function(e){if(e>v){if(.5==e)return void(A[R.RIGHT_TRIGGER]=!1);f=-5.5*e+6}else f=6},L=function(){var e=o.getState(S);i.push(e),T.logger.log("Savepoint created.")},N=function(){i.length&&(--r<0&&(r=i.length-1),o.restoreState(i[r]))},U=function(){i.length&&(++r>=i.length&&(r=0),o.restoreState(i[r]))},V=function(){var t=e.impl.hitTestViewport(new THREE.Vector3(0,0,0));"headtracker"==c&&h.updateMatrixWorld(),t?e.impl.selector.toggleSelection(t.dbId,t.model):e.impl.selector.clearSelection()},x=function(){e.impl.selector.clearSelection()},B=function(){e.showAll(),e.impl.selector.clearSelection(),e.explode(0)},M=function(){var t=e.impl.hitTestViewport(new THREE.Vector3(0,0,0),!1);t&&(t.dbId in e.getHiddenNodes()?e.show(t.dbId):e.hide(t.dbId))},K=function(){e.getPropertyPanel(!0).setVisible(!e.getPropertyPanel(!0).isVisible())},Y=function(){(s=!s)&&(l=h.position.z),H("up")}}function o(e){var t=Autodesk.Viewing.Private,a=-1!=navigator.userAgent.search("Mac OS"),o=e.navigation,i=e.container,r=o.getCamera(),s=["firstperson"];this.setGlobalManager(e.globalManager);var u,l={SHIFT:0,ALT:0,CONTROL:0},c=Autodesk.Viewing.KeyCode,T=!1,d=!0,g=!1,h=null,p=new THREE.Clock(!0),v=-1,f=5e3,A=1,E=2,S=0,R=-1e20,I=-1e20,_=0,m=0,b=!1,O=!1,H=!1,P=!1,C=!1,w=!1,k=(r.fov,r.isPerspective,!1);(navigator.getGamepads||navigator.webkitGetGamepads||navigator.webkitGamepads)&&(u=new n(e));var G=!1;this.isActive=function(){return T},this.getNames=function(){return s},this.getName=function(){return s[0]},this.activate=function(t){p.start(),r.isPerspective,o.toPerspective(),r.fov,o.setVerticalFov(75,!0),e.model.getUnitScale();var a=e.model.getBoundingBox().size();A=Math.max(Math.min(Math.min(a.x,a.y),a.z)/10,1e-4),e.canvas.focus(),T=!0,e.getFirstPersonToolPopup()&&!k&&N(),this.addCrosshair(),e.impl.pauseHighlight(!0),u&&u.activate(this.getName())},this.deactivate=function(t){T=!1,p.stop(),F(),this.removeCrosshair(),e.impl.pauseHighlight(!1),u&&u.deactivate()},this.getCursor=function(){return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3goOFQoQszohGAAAA9hJREFUSMedll1oHGUUhp8zuzP5291pEvNTomgVjFCCCa0NpAqJEJTUFVv8uWxQLwKCF6IUr7wJ6J30QvBCAlZssA0EkYJaAm1FwU3iakrbVNNuutlukk3dzWyT/ZnJ7ufFTtokbmvX72Y45+N73/Oe8858I+xYSikBJJFI7AmFQh9alvVWoVC47vP5ho4cOXJeRGwqWN4yOQ2oHh0dPROJRNo7OjqIRCKPRxeiP66srBxSSn0vIsX/RaCU0gDV399vNjQ0tB8/fpxAIEAsFuP06dPEYrFvgHqguEMxIqLKdUPbmnArU52dnb2maWJUGeRyOWzbpqGxgXg87gOMncDlwLe2Y5uCwcHBFp/P90k4PE349xkWolGi0SjhPy5hF+UmIEopz/1AtxRcqmJzDQ8P7750+Wq8e9+TPGLe4sSp39jz9LMsxm/izE6gOVnquoIcOHDgnddfe/VEU3PLWkUzSCQSesCzxNtvHKZu11O0137OuTMneYY1+l+px99sci5zgU+/Pv/Z5OTkWeCvigja2tqqri3/RPbiMfSWLvY+/wJ7XwxCOoyz+gPF5C0OzsFZv8NEOOxU7KL5+fkcooFUo9avYt+4htTU43noJVTmIPYvp8hnChSKCr/fr1VMkEqlCgEATUDTAIVykhSWRtj4M4/KKzZ9Z9u2ehCCbVUYhlEaurg7m09NB/GWYhe2r69vV8UEvb29DeIWL+6uIG6w6b1SGAqF0hUTZDKZ7GLKy1w0h+Z1keQuMEDOKbK+oZFIJOyKZqCUEsuy/k4mk6kr0ZH6/Z2CkrttEl1QjuJkKI3z6KGp6vTFpYoVmKaZ9Xg8lleDoq3IzOdBILuygbVgs2YVSNrgOM7o1NTURkUE7qufX15evo5A0VHcnrNRgFgFJF6gsVmntlaIxWKNIlK/s8D/VCAianZ29spmv0vfVoVuaNT6PYhWMpGIGIZhNAGtQC3bbXDfj51YlrWObHeOKu3didfX1x3btgGqgADgu5eafyXT6XT2zmDLnVDg9Xq9uq573fMeQAeqy+HtTAgguq7h0aUsgyZCJpPZcBxnE1xz3fhACqp7enoe+3ZimVg8j6ELiIACEUETWErnsCwrD2h1dXW6C+4A2a033T0VfPD+e8dePvoFb36sM/LzKomkQ1FgMW3z7neL3Gh6jtbW1rmamhrDNM0NYAVIAYWyl06ZPwoNeHh6evqJmZmZiV8vnCBw+yLRRCv7gkdpamr6aGho6KuBgQFnfHx88V7AZQlcEt01jgD+sbGx3V+OjPR07d8fDQaDl1OpVLK7u9swTXP1Qa7NfwCi46BIaoRmhAAAAABJRU5ErkJggg==), auto"},this.adjustSpeed=function(e){0===e?E=2:(E*=e>0?1.1:.9)<.01&&(E=.01)},this.handleGesture=function(e){switch(e.pointers&&e.pointers.length>0&&(e.pageX=e.pointers[0].pageX,e.pageY=e.pointers[0].pageY),e.type){case"dragstart":return h="drag",this.handleButtonDown(e,0);case"dragmove":return"drag"===h&&this.handleMouseMove(e);case"dragend":return"drag"===h&&(this.handleButtonUp(e,0),h=null,!0)}return!1},this.handleSingleClick=function(e,t){return!1},this.handleButtonDown=function(e,t){var n=this.getWindow();F(),1<<t;var o=function(e){if(h)return!1;var t=e.ctrlKey||a&&e.metaKey,n=e.metaKey&&!a;return t||n||e.shiftKey||e.altKey}(e);return!(0===t&&!o)||(e.pageX-n.innerWidth/2,e.pageY-n.innerHeight/2,R=e.pageX,I=e.pageY,_=m=0,0,g=!0,!0)},this.handleMouseMove=function(e){var t=R<-1e10?0:e.pageX-R,a=I<-1e10?0:e.pageY-I;return R=e.pageX,I=e.pageY,g===d&&(_+=.0035*t,m+=.0035*a),!0},this.handleButtonUp=function(e,t){return 1<<t,0!==t||!g||(_=m=0,0,g=!1,!0)},this.handleKeyDown=function(e,t){F();var a=!1;switch(t){case c.ESCAPE:break;case c.TAB:a=!1;break;case c.SHIFT:l.SHIFT=1,a=!0;break;case c.CONTROL:l.CONTROL=1,a=!0;break;case c.ALT:l.ALT=1,a=!0;break;case c.SPACE:l.SPACE=1,a=!0;break;case c.EQUALS:this.adjustSpeed(1),a=!0;break;case c.DASH:this.adjustSpeed(-1),a=!0;break;case c.ZERO:this.adjustSpeed(0),a=!0;break;case c.UP:case c.w:b=!0,a=!0;break;case c.LEFT:case c.a:H=!0,a=!0;break;case c.DOWN:case c.s:O=!0,a=!0;break;case c.RIGHT:case c.d:P=!0,a=!0;break;case c.q:C=!0,a=!0;break;case c.e:w=!0,a=!0;break;case c.g:case c.F1:a=!0}return a},this.handleKeyUp=function(e,t){var a=!1;switch(t){case c.TAB:a=!1;break;case c.SHIFT:l.SHIFT=0,a=!0;break;case c.CONTROL:l.CONTROL=0,a=!0;break;case c.ALT:l.ALT=0,a=!0;break;case c.SPACE:l.SPACE=0,a=!0;break;case c.UP:case c.w:b=!1,a=!0,D();break;case c.LEFT:case c.a:H=!1,a=!0,D();break;case c.DOWN:case c.s:O=!1,a=!0,D();break;case c.RIGHT:case c.d:P=!1,a=!0,D();break;case c.q:C=!1,a=!0,D();break;case c.e:w=!1,a=!0,D();break;case c.g:0,L(d=!d),a=!0;break;case c.F1:N(),a=!0}return a},this.handleWheelInput=function(e){return o.getReverseZoomDirection()&&(e*=-1),S+=e,!0},this.handleSingleClick=function(e,t){return!1},this.handleDoubleClick=function(e,t){return!1},this.handleSingleTap=function(e){return this.handleSingleClick(e,0)},this.handleDoubleTap=function(e){return!1},this.handleBlur=function(e){return b=O=!1,H=P=!1,C=w=!1,!1},this.update=function(){if(!T||!o.isActionEnabled("walk"))return!1;var e=p.getDelta();v>-1&&((new Date).getTime()-v>f&&F());r.isPerspective||(console.log("Lost perspective mode: resetting view."),o.toPerspective());var t=r.clone(),a=e*E*A*(1===l.SHIFT?4:1),n=.5*e*A*(1===l.SHIFT?4:1);if(0!=S){var i=1*S*A*(1===l.SHIFT?4:1);t.translateZ(-i),S=0}b&&t.translateZ(-a),O&&t.translateZ(a),H&&t.translateX(-a),P&&t.translateX(a),C&&t.translateY(n),w&&t.translateY(-n);var s=t.position,c=0!==s.distanceToSquared(r.position),d=t.target,g=r.target.clone().sub(r.position),h=g.clone().cross(r.up).normalize();if(0!=m){var R=new THREE.Quaternion;R.setFromAxisAngle(h,-m);var I=g.clone();I.applyQuaternion(R);var k=r.worldup.clone(),G=I.angleTo(k),D=THREE.Math.degToRad(5);G>=D&&G<=Math.PI-D&&(g.applyQuaternion(R),t.up.applyQuaternion(R)),m=0}if(0!=_){var y=new THREE.Quaternion;y.setFromAxisAngle(r.worldup,-_),g.applyQuaternion(y),t.up.applyQuaternion(y),_=0}var L=0!==(d=s.clone().add(g)).distanceToSquared(r.target);return(c||L)&&(o.setView(s,d),o.orientCameraUp()),u&&(r=u.update(r)),r.dirty};var D=function(){G||(t.logger.track({category:"tool_used",name:"FirstPerson_tool"}),G=!0)},y=function(e,t,a,n,o){Autodesk.Viewing.Private.HudMessage&&(Autodesk.Viewing.Private.HudMessage.displayMessage(i,e,a,n,o),t>0?(v=(new Date).getTime(),f=t):(v=-1,f=0))},F=function(){Autodesk.Viewing.Private.HudMessage&&Autodesk.Viewing.Private.HudMessage.dismiss(),v=-1},L=function(e){F();var t=e?"Press the primary mouse button and drag to change the view orientation":"Move the cursor to change the view orientation";y({msgTitleKey:"First Person Tool",messageKey:t,messageDefaultValue:t},0,(function(){}))},N=function(){F();y({msgTitleKey:"First Person Tool",messageKey:"Use the WASD and QE keys to move",messageDefaultValue:"Use the WASD and QE keys to move",buttonText:"Ok Got It"},0,(function(){}),(function(){k=!0,e.setFirstPersonToolPopup(!1),F()}))};this.addCrosshair=function(){t.stringToDOM&&(this.crosshair=t.stringToDOM('<div id="remote-crosshair"><div class="crosshair-v"></div><div class="crosshair-h"></div></div>f'),e.canvasWrap.appendChild(this.crosshair))},this.removeCrosshair=function(){this.crosshair&&this.crosshair.parentNode&&this.crosshair.parentNode.removeChild(this.crosshair)}}function i(e,t){Autodesk.Viewing.Extension.call(this,e,t),this.name="firstperson"}a.r(t),Autodesk.Viewing.GlobalManagerMixin.call(o.prototype),a.d(t,"FirstPersonExtension",(function(){return i})),i.prototype=Object.create(Autodesk.Viewing.Extension.prototype),i.prototype.constructor=i;var r=i.prototype;r.load=function(){var e=this,t=this.viewer,a=Autodesk.Viewing.UI;return this.tool=new o(t),t.toolController.registerTool(this.tool),this.createUI(),this.onToolChanged=function(t){if(-1!==t.toolName.indexOf("firstperson")&&e.firstPersonToolButton){var n=t.active?a.Button.State.ACTIVE:a.Button.State.INACTIVE;e.firstPersonToolButton.setState(n)}},t.addEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged),!0},r.createUI=function(){var e=this.viewer;if(e.getToolbar){var t=this,a=Autodesk.Viewing.UI,n=e.getToolbar().getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID);this.firstPersonToolButton=new a.Button("toolbar-firstPersonTool"),this.firstPersonToolButton.setToolTip("First person"),this.firstPersonToolButton.onClick=function(e){t.activeStatus?t.deactivate():t.activate()},this.firstPersonToolButton.setIcon("adsk-icon-first-person");var o=n.getControl("toolbar-cameraSubmenuTool");o?n.addControl(this.firstPersonToolButton,{index:n.indexOf(o.getId())}):n.addControl(this.firstPersonToolButton)}},r.unload=function(){var e=this.viewer;(e.removeEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged),this.onToolChanged=void 0,e.getHotkeyManager().popHotkeys(this.HOTKEYS_ID),this.firstPersonToolButton)&&(e.getToolbar()&&this.firstPersonToolButton.removeFromParent(),this.firstPersonToolButton=null);return e.getActiveNavigationTool()==this.tool.getName()&&e.setActiveNavigationTool(),e.toolController.deregisterTool(this.tool),this.tool=null,!0},r.activate=function(){return this.activeStatus||(this.viewer.setActiveNavigationTool("firstperson"),this.activeStatus=!0),!0},r.deactivate=function(){return this.activeStatus&&(this.viewer.setActiveNavigationTool(),this.activeStatus=!1),!0},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.FirstPerson",i)}});
//# sourceMappingURL=FirstPerson.min.js.map