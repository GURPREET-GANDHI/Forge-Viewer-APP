/*!
 * LMV v7.11.0
 * 
 * Copyright 2020 Autodesk, Inc.
 * All rights reserved.
 * 
 * This computer source code and related instructions and comments are the
 * unpublished confidential and proprietary information of Autodesk, Inc.
 * and are protected under Federal copyright and state trade secret law.
 * They may not be disclosed to, copied or used by any third party without
 * the prior written consent of Autodesk, Inc.
 * 
 * Autodesk Forge Viewer Usage Limitations:
 * 
 * The Autodesk Forge viewer can only be used to view files generated by
 * Autodesk Forge services. The Autodesk Forge Viewer JavaScript must be
 * delivered from an Autodesk hosted URL.
 */
Autodesk.Extensions.Section=function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=562)}({3:function(e,t){e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n=e[1]||"",i=e[3];if(!i)return n;if(t&&"function"==typeof btoa){var o=(a=i,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */"),r=i.sources.map((function(e){return"/*# sourceURL="+i.sourceRoot+e+" */"}));return[n].concat(r).concat([o]).join("\n")}var a;return[n].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+n+"}":n})).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var i={},o=0;o<this.length;o++){var r=this[o][0];"number"==typeof r&&(i[r]=!0)}for(o=0;o<e.length;o++){var a=e[o];"number"==typeof a[0]&&i[a[0]]||(n&&!a[2]?a[2]=n:n&&(a[2]="("+a[2]+") and ("+n+")"),t.push(a))}},t}},307:function(e,t,n){var i=n(308);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(4)(i,o);i.locals&&(e.exports=i.locals)},308:function(e,t,n){(e.exports=n(3)(!1)).push([e.i,".sectionPanel{line-height:14px;text-align:left;z-index:10}.section-horizontal-divider{height:1px;border-top:1px solid rgba(200,200,200,0.8)}.section-submenu-select{display:block;position:relative;width:calc(100% - 40px);padding:10px 20px 0px 20px;opacity:0.3}.section-panel:hover .section-submenu-select{opacity:0.8}.section-submenu-selectlabel{position:relative;display:inline-block;padding-right:20px;padding-bottom:4px}.section-restart{margin:10px 20px 15px 20px;padding:6px 10px 6px 10px;width:calc(100% - 55px);cursor:pointer}.docking-panel:hover .section-restart{background-color:rgba(255,255,255,0.12)}.docking-panel .section-restart:hover{background-color:rgba(166,194,255,0.7);-webkit-transition:all 0.2s ease;-moz-transition:all 0.2s ease;-ms-transition:all 0.2s ease;-o-transition:all 0.2s ease;transition:all 0.2s ease}\n",""])},4:function(e,t,n){var i,o,r={},a=(i=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===o&&(o=i.apply(this,arguments)),o}),s=function(e,t){return t?t.querySelector(e):document.querySelector(e)},c=function(e){var t={};return function(e,n){if("function"==typeof e)return e();if(void 0===t[e]){var i=s.call(this,e,n);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}t[e]=i}return t[e]}}(),l=null,h=0,u=[],E=n(5);function p(e,t){for(var n=0;n<e.length;n++){var i=e[n],o=r[i.id];if(o){o.refs++;for(var a=0;a<o.parts.length;a++)o.parts[a](i.parts[a]);for(;a<i.parts.length;a++)o.parts.push(y(i.parts[a],t))}else{var s=[];for(a=0;a<i.parts.length;a++)s.push(y(i.parts[a],t));r[i.id]={id:i.id,refs:1,parts:s}}}}function d(e,t){for(var n=[],i={},o=0;o<e.length;o++){var r=e[o],a=t.base?r[0]+t.base:r[0],s={css:r[1],media:r[2],sourceMap:r[3]};i[a]?i[a].parts.push(s):n.push(i[a]={id:a,parts:[s]})}return n}function m(e,t){var n=c(e.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var i=u[u.length-1];if("top"===e.insertAt)i?i.nextSibling?n.insertBefore(t,i.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),u.push(t);else if("bottom"===e.insertAt)n.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var o=c(e.insertAt.before,n);n.insertBefore(t,o)}}function f(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=u.indexOf(e);t>=0&&u.splice(t,1)}function v(e){var t=document.createElement("style");if(void 0===e.attrs.type&&(e.attrs.type="text/css"),void 0===e.attrs.nonce){var i=function(){0;return n.nc}();i&&(e.attrs.nonce=i)}return T(t,e.attrs),m(e,t),t}function T(e,t){Object.keys(t).forEach((function(n){e.setAttribute(n,t[n])}))}function y(e,t){var n,i,o,r;if(t.transform&&e.css){if(!(r="function"==typeof t.transform?t.transform(e.css):t.transform.default(e.css)))return function(){};e.css=r}if(t.singleton){var a=h++;n=l||(l=v(t)),i=g.bind(null,n,a,!1),o=g.bind(null,n,a,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(e){var t=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",T(t,e.attrs),m(e,t),t}(t),i=x.bind(null,n,t),o=function(){f(n),n.href&&URL.revokeObjectURL(n.href)}):(n=v(t),i=H.bind(null,n),o=function(){f(n)});return i(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;i(e=t)}else o()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=a()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var n=d(e,t);return p(n,t),function(e){for(var i=[],o=0;o<n.length;o++){var a=n[o];(s=r[a.id]).refs--,i.push(s)}e&&p(d(e,t),t);for(o=0;o<i.length;o++){var s;if(0===(s=i[o]).refs){for(var c=0;c<s.parts.length;c++)s.parts[c]();delete r[s.id]}}}};var w,R=(w=[],function(e,t){return w[e]=t,w.filter(Boolean).join("\n")});function g(e,t,n,i){var o=n?"":i.css;if(e.styleSheet)e.styleSheet.cssText=R(t,o);else{var r=document.createTextNode(o),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(r,a[t]):e.appendChild(r)}}function H(e,t){var n=t.css,i=t.media;if(i&&e.setAttribute("media",i),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}function x(e,t,n){var i=n.css,o=n.sourceMap,r=void 0===t.convertToAbsoluteUrls&&o;(t.convertToAbsoluteUrls||r)&&(i=E(i)),o&&(i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */");var a=new Blob([i],{type:"text/css"}),s=e.href;e.href=URL.createObjectURL(a),s&&URL.revokeObjectURL(s)}},5:function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var n=t.protocol+"//"+t.host,i=n+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(e,t){var o,r=t.trim().replace(/^"(.*)"$/,(function(e,t){return t})).replace(/^'(.*)'$/,(function(e,t){return t}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(r)?e:(o=0===r.indexOf("//")?r:0===r.indexOf("/")?n+r:i+r.replace(/^\.\//,""),"url("+JSON.stringify(o)+")")}))}},562:function(e,t,n){"use strict";function i(){var e=function(e){THREE.MeshBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.side=THREE.FrontSide,this.transparent=!0,this.setValues(e),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(e){e?(this.color.setRGB(1,230/255,3/255),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};e.prototype=Object.create(THREE.MeshBasicMaterial.prototype);var t=function(e){THREE.LineBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.transparent=!0,this.linewidth=1,this.setValues(e),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(e){e?(this.color.setRGB(1,230/255,3/255),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};t.prototype=Object.create(THREE.LineBasicMaterial.prototype),void 0===THREE.PolyhedronGeometry&&(THREE.PolyhedronGeometry=function(e,t,n,i){THREE.Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i},n=n||1,i=i||0;for(var o=this,r=0,a=e.length;r<a;r+=3)w(new THREE.Vector3(e[r],e[r+1],e[r+2]));var s=this.vertices,c=[],l=(r=0,0);for(a=t.length;r<a;r+=3,l++){var h=s[t[r]],u=s[t[r+1]],E=s[t[r+2]];c[l]=new THREE.Face3(h.index,u.index,E.index,[h.clone(),u.clone(),E.clone()])}var p=new THREE.Vector3;for(r=0,a=c.length;r<a;r++)g(c[r],i);for(r=0,a=this.faceVertexUvs[0].length;r<a;r++){var d=this.faceVertexUvs[0][r],m=d[0].x,f=d[1].x,v=d[2].x,T=Math.max(m,Math.max(f,v)),y=Math.min(m,Math.min(f,v));T>.9&&y<.1&&(m<.2&&(d[0].x+=1),f<.2&&(d[1].x+=1),v<.2&&(d[2].x+=1))}for(r=0,a=this.vertices.length;r<a;r++)this.vertices[r].multiplyScalar(n);function w(e){var t=e.normalize().clone();t.index=o.vertices.push(t)-1;var n=H(e)/2/Math.PI+.5,i=function(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}(e)/Math.PI+.5;return t.uv=new THREE.Vector2(n,1-i),t}function R(e,t,n){var i=new THREE.Face3(e.index,t.index,n.index,[e.clone(),t.clone(),n.clone()]);o.faces.push(i),p.copy(e).add(t).add(n).divideScalar(3);var r=H(p);o.faceVertexUvs[0].push([x(e.uv,e,r),x(t.uv,t,r),x(n.uv,n,r)])}function g(e,t){for(var n=Math.pow(2,t),i=(Math.pow(4,t),w(o.vertices[e.a])),r=w(o.vertices[e.b]),a=w(o.vertices[e.c]),s=[],c=0;c<=n;c++){s[c]=[];for(var l=w(i.clone().lerp(a,c/n)),h=w(r.clone().lerp(a,c/n)),u=n-c,E=0;E<=u;E++)s[c][E]=0==E&&c==n?l:w(l.clone().lerp(h,E/u))}for(c=0;c<n;c++)for(E=0;E<2*(n-c)-1;E++){var p=Math.floor(E/2);E%2==0?R(s[c][p+1],s[c+1][p],s[c][p]):R(s[c][p+1],s[c+1][p+1],s[c+1][p])}}function H(e){return Math.atan2(e.z,-e.x)}function x(e,t,n){return n<0&&1===e.x&&(e=new THREE.Vector2(e.x-1,e.y)),0===t.x&&0===t.z&&(e=new THREE.Vector2(n/2/Math.PI+.5,e.y)),e.clone()}this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,n)},THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype)),void 0===THREE.OctahedronGeometry&&(THREE.OctahedronGeometry=function(e,t){this.parameters={radius:e,detail:t};THREE.PolyhedronGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}},THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype)),void 0===THREE.TorusGeometry&&(THREE.TorusGeometry=function(e,t,n,i,o){THREE.Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:o},e=e||100,t=t||40,n=n||8,i=i||6,o=o||2*Math.PI;for(var r=new THREE.Vector3,a=[],s=[],c=0;c<=n;c++)for(var l=0;l<=i;l++){var h=l/i*o,u=c/n*Math.PI*2;r.x=e*Math.cos(h),r.y=e*Math.sin(h);var E=new THREE.Vector3;E.x=(e+t*Math.cos(u))*Math.cos(h),E.y=(e+t*Math.cos(u))*Math.sin(h),E.z=t*Math.sin(u),this.vertices.push(E),a.push(new THREE.Vector2(l/i,c/n)),s.push(E.clone().sub(r).normalize())}for(c=1;c<=n;c++)for(l=1;l<=i;l++){var p=(i+1)*c+l-1,d=(i+1)*(c-1)+l-1,m=(i+1)*(c-1)+l,f=(i+1)*c+l,v=new THREE.Face3(p,d,f,[s[p].clone(),s[d].clone(),s[f].clone()]);this.faces.push(v),this.faceVertexUvs[0].push([a[p].clone(),a[d].clone(),a[f].clone()]),v=new THREE.Face3(d,m,f,[s[d].clone(),s[m].clone(),s[f].clone()]),this.faces.push(v),this.faceVertexUvs[0].push([a[d].clone(),a[m].clone(),a[f].clone()])}this.computeFaceNormals()},THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype));var n,i,o,r=function(e,t,n){var i=new THREE.Geometry;n=n||1;for(var o=0;o<=64*n;++o)"x"==t&&i.vertices.push(new THREE.Vector3(0,Math.cos(o/32*Math.PI),Math.sin(o/32*Math.PI)).multiplyScalar(e)),"y"==t&&i.vertices.push(new THREE.Vector3(Math.cos(o/32*Math.PI),0,Math.sin(o/32*Math.PI)).multiplyScalar(e)),"z"==t&&i.vertices.push(new THREE.Vector3(Math.sin(o/32*Math.PI),Math.cos(o/32*Math.PI),0).multiplyScalar(e));return i},a=function(e,t,n,i,o,r){var a=new THREE.Geometry,s=new THREE.Mesh(new THREE.CylinderGeometry(e,t,n,i,o,r));return s.position.y=.5,s.updateMatrix(),a.merge(s.geometry,s.matrix),a},s=function(e){var t=new THREE.Geometry;return"X"===e?t.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(1,0,0)):"Y"===e?t.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0)):"Z"===e&&t.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1)),t};THREE.TransformGizmo=function(){var e=this;this.init=function(){THREE.Object3D.call(this),this.handles=new THREE.Object3D,this.pickers=new THREE.Object3D,this.planes=new THREE.Object3D,this.highlights=new THREE.Object3D,this.hemiPicker=new THREE.Object3D,this.subPickers=new THREE.Object3D,this.add(this.handles),this.add(this.pickers),this.add(this.planes),this.add(this.highlights),this.add(this.hemiPicker),this.add(this.subPickers);var e=new THREE.PlaneBufferGeometry(50,50,2,2),t=new THREE.MeshBasicMaterial({wireframe:!0});t.side=THREE.DoubleSide;var n={XY:new THREE.Mesh(e,t),YZ:new THREE.Mesh(e,t),XZ:new THREE.Mesh(e,t),XYZE:new THREE.Mesh(e,t)};for(var i in this.activePlane=n.XYZE,n.YZ.rotation.set(0,Math.PI/2,0),n.XZ.rotation.set(-Math.PI/2,0,0),n)n[i].name=i,this.planes.add(n[i]),this.planes[i]=n[i],n[i].visible=!1;this.setupGizmos(),this.activeMode="",this.traverse((function(e){if(e instanceof THREE.Mesh){e.updateMatrix();var t=new THREE.Geometry;e.geometry instanceof THREE.BufferGeometry&&(e.geometry=(new THREE.Geometry).fromBufferGeometry(e.geometry)),t.merge(e.geometry,e.matrix),e.geometry=t,e.position.set(0,0,0),e.rotation.set(0,0,0),e.scale.set(1,1,1)}}))},this.hide=function(){this.traverse((function(e){e.visible=!1}))},this.show=function(){this.traverse((function(t){t.visible=!0,t.parent!=e.pickers&&t.parent!=e.hemiPicker||(t.visible=!1),t.parent==e.planes&&(t.visible=!1)})),this.activePlane.visible=!1},this.highlight=function(e){this.traverse((function(t){t.material&&t.material.highlight&&(t.name==e?t.material.highlight(!0):t.material.highlight(!1))}))},this.setupGizmos=function(){var e=function(e,t){for(var n in e)for(var i=e[n].length;i--;){var o=e[n][i][0],r=e[n][i][1],a=e[n][i][2],s=e[n][i][3];o.name=n,r&&o.position.set(r[0],r[1],r[2]),a&&o.rotation.set(a[0],a[1],a[2]),s&&(o.visble=s),t.add(o)}};this.setHandlePickerGizmos(),e(this.handleGizmos,this.handles),e(this.pickerGizmos,this.pickers),e(this.highlightGizmos,this.highlights),e(this.hemiPickerGizmos,this.hemiPicker),e(this.subPickerGizmos,this.subPickers),this.hide(),this.show()}},THREE.TransformGizmo.prototype=Object.create(THREE.Object3D.prototype),THREE.TransformGizmo.prototype.update=function(e,t){var n=new THREE.Vector3(0,0,0),i=new THREE.Vector3(0,1,0),o=new THREE.Matrix4;this.traverse((function(r){r.name&&(-1!=r.name.search("E")?r.quaternion.setFromRotationMatrix(o.lookAt(t,n,i)):-1==r.name.search("X")&&-1==r.name.search("Y")&&-1==r.name.search("Z")||r.quaternion.setFromEuler(e))}))},THREE.TransformGizmoTranslate=function(){THREE.TransformGizmo.call(this),this.setHandlePickerGizmos=function(){var n=a(0,.05,.2,12,1,!1),i=s("X"),o=s("Y"),r=s("Z");this.handleGizmos={X:[[new THREE.Mesh(n,new e({color:15805484})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(i,new t({color:15805484}))]],Y:[[new THREE.Mesh(n,new e({color:768011})),[0,.5,0]],[new THREE.Line(o,new t({color:768011}))]],Z:[[new THREE.Mesh(n,new e({color:2895089})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(r,new t({color:2895089}))]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.1,0),new e({color:16777215,opacity:.25})),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new e({color:16776960,opacity:.25})),[.15,.15,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new e({color:65535,opacity:.25})),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new e({color:16711935,opacity:.25})),[.15,0,.15],[-Math.PI/2,0,0]]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new e({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new e({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new e({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.2,0),new e({color:16777215,opacity:.25}))]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new e({color:16776960,opacity:.25})),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new e({color:65535,opacity:.25})),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new e({color:16711935,opacity:.25})),[.2,0,.2],[-Math.PI/2,0,0]]]},this.hemiPickerGizmos={XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(1.2,1.2,1.2),new e({color:255})),[.5,.5,.5],null,!1]]}},this.setActivePlane=function(e,t){var n=new THREE.Matrix4;t.applyMatrix4(n.getInverse(n.extractRotation(this.planes.XY.matrixWorld))),"X"==e&&(this.activePlane=this.planes.XY,Math.abs(t.y)>Math.abs(t.z)&&(this.activePlane=this.planes.XZ)),"Y"==e&&(this.activePlane=this.planes.XY,Math.abs(t.x)>Math.abs(t.z)&&(this.activePlane=this.planes.YZ)),"Z"==e&&(this.activePlane=this.planes.XZ,Math.abs(t.x)>Math.abs(t.y)&&(this.activePlane=this.planes.YZ)),"XYZ"==e&&(this.activePlane=this.planes.XYZE),"XY"==e&&(this.activePlane=this.planes.XY),"YZ"==e&&(this.activePlane=this.planes.YZ),"XZ"==e&&(this.activePlane=this.planes.XZ),this.hide(),this.show()},this.init()},THREE.TransformGizmoTranslate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoRotate=function(){THREE.TransformGizmo.call(this),this.setHandlePickerGizmos=function(){this.handleGizmos={RX:[[new THREE.Line(r(1,"x",.5),new t({color:16711680}))]],RY:[[new THREE.Line(r(1,"y",.5),new t({color:65280}))]],RZ:[[new THREE.Line(r(1,"z",.5),new t({color:255}))]],RE:[[new THREE.Line(r(1.25,"z",1),new t({color:65535}))]],RXYZE:[[new THREE.Line(r(1,"z",1),new t({color:16711935}))]]},this.pickerGizmos={RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new e({color:16711680,opacity:.25})),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new e({color:65280,opacity:.25})),[0,0,0],[Math.PI/2,0,0]]],RZ:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new e({color:255,opacity:.25})),[0,0,0],[0,0,-Math.PI/2]]],RE:[[new THREE.Mesh(new THREE.TorusGeometry(1.25,.12,2,24),new e({color:65535,opacity:.25}))]],RXYZE:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,2,24),new e({color:16711935,opacity:.25}))]]}},this.setActivePlane=function(e){"RE"==e&&(this.activePlane=this.planes.XYZE),"RX"==e&&(this.activePlane=this.planes.YZ),"RY"==e&&(this.activePlane=this.planes.XZ),"RZ"==e&&(this.activePlane=this.planes.XY),this.hide(),this.show()},this.update=function(e,t){THREE.TransformGizmo.prototype.update.apply(this,arguments);var n=new THREE.Matrix4,i=new THREE.Euler(0,0,1),o=new THREE.Quaternion,r=new THREE.Vector3(1,0,0),a=new THREE.Vector3(0,1,0),s=new THREE.Vector3(0,0,1),c=new THREE.Quaternion,l=new THREE.Quaternion,h=new THREE.Quaternion,u=t.clone();i.copy(this.planes.XY.rotation),o.setFromEuler(i),n.makeRotationFromQuaternion(o).getInverse(n),u.applyMatrix4(n),this.traverse((function(e){o.setFromEuler(i),"RX"==e.name&&(c.setFromAxisAngle(r,Math.atan2(-u.y,u.z)),o.multiplyQuaternions(o,c),e.quaternion.copy(o)),"RY"==e.name&&(l.setFromAxisAngle(a,Math.atan2(u.x,u.z)),o.multiplyQuaternions(o,l),e.quaternion.copy(o)),"RZ"==e.name&&(h.setFromAxisAngle(s,Math.atan2(u.y,u.x)),o.multiplyQuaternions(o,h),e.quaternion.copy(o))}))},this.init()},THREE.TransformGizmoRotate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoTranslateRotate=function(){THREE.TransformGizmo.call(this);var t=this;this.setHandlePickerGizmos=function(){var t=a(0,.05,.2,12,1,!1);(new THREE.Geometry).vertices.push(new THREE.Vector3(0,0,-.1),new THREE.Vector3(0,0,.1),new THREE.Vector3(-.1,0,0),new THREE.Vector3(.1,0,0));this.handleGizmos={Z:[[new THREE.Mesh(t,new e({color:16777215})),[0,0,.25],[Math.PI/2,0,0]],[new THREE.Mesh(new THREE.CylinderGeometry(.015,.015,.6,4,1,!1),new e({color:16777215})),[0,0,.5],[Math.PI/2,0,0]]],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.015,12,60,.3*Math.PI),new e({color:16711680})),[0,0,0],[.15*Math.PI,-Math.PI/2,0]],[new THREE.Mesh(new THREE.CylinderGeometry(.05,.05,.015,60,1,!1),new e({color:16711680})),[0,0,1],[Math.PI/2,0,0]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.015,12,60,.3*Math.PI),new e({color:255})),[0,0,0],[Math.PI/2,0,.35*Math.PI]],[new THREE.Mesh(new THREE.CylinderGeometry(.05,.05,.01,60,1,!1),new e({color:255})),[0,0,1]]]},this.pickerGizmos={Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.12,.12,.65,4,1,!1),new e({color:255,opacity:.25})),[0,0,.5],[Math.PI/2,0,0]]],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,.3*Math.PI),new e({color:16711680,opacity:.25})),[0,0,0],[.15*Math.PI,-Math.PI/2,0]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,.3*Math.PI),new e({color:255,opacity:.25})),[0,0,0],[Math.PI/2,0,.35*Math.PI]]]},this.subPickerGizmos={Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.12,.12,.65,4,1,!1),new e({color:255,opacity:.25})),[0,0,.5],[Math.PI/2,0,0]]]},this.highlightGizmos={Z:[],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.02,12,60,2*Math.PI),new e({color:16711680,opacity:1})),[0,0,0],[0,-Math.PI/2,-Math.PI/2],!1]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.02,12,60,2*Math.PI),new e({color:255,opacity:1})),[0,0,0],[Math.PI/2,0,0],!1]]},this.hemiPickerGizmos={XYZ:[[new THREE.Mesh(new THREE.SphereGeometry(1.2,8,8,0,Math.PI),new e({color:255})),null,null,!1]]}},this.setActivePlane=function(e,t){if("translate"==this.activeMode){var n=new THREE.Matrix4;t.applyMatrix4(n.getInverse(n.extractRotation(this.planes.XY.matrixWorld))),"X"==e&&(this.activePlane=this.planes.XY,Math.abs(t.y)>Math.abs(t.z)&&(this.activePlane=this.planes.XZ)),"Y"==e&&(this.activePlane=this.planes.XY,Math.abs(t.x)>Math.abs(t.z)&&(this.activePlane=this.planes.YZ)),"Z"==e&&(this.activePlane=this.planes.XZ,Math.abs(t.x)>Math.abs(t.y)&&(this.activePlane=this.planes.YZ))}else"rotate"==this.activeMode&&("RX"==e&&(this.activePlane=this.planes.YZ),"RY"==e&&(this.activePlane=this.planes.XZ),"RZ"==e&&(this.activePlane=this.planes.XY));this.hide(),this.show()},this.update=function(e,t){if("translate"==this.activeMode)THREE.TransformGizmo.prototype.update.apply(this,arguments);else if("rotate"==this.activeMode){THREE.TransformGizmo.prototype.update.apply(this,arguments);var n=new THREE.Matrix4,i=new THREE.Euler(0,0,1),o=new THREE.Quaternion,r=new THREE.Vector3(1,0,0),a=new THREE.Vector3(0,1,0),s=new THREE.Vector3(0,0,1),c=new THREE.Quaternion,l=new THREE.Quaternion,h=new THREE.Quaternion,u=t.clone();i.copy(this.planes.XY.rotation),o.setFromEuler(i),n.makeRotationFromQuaternion(o).getInverse(n),u.applyMatrix4(n),this.traverse((function(e){o.setFromEuler(i),"RX"==e.name&&(c.setFromAxisAngle(r,Math.atan2(-u.y,u.z)),o.multiplyQuaternions(o,c),e.quaternion.copy(o)),"RY"==e.name&&(l.setFromAxisAngle(a,Math.atan2(u.x,u.z)),o.multiplyQuaternions(o,l),e.quaternion.copy(o)),"RZ"==e.name&&(h.setFromAxisAngle(s,Math.atan2(u.y,u.x)),o.multiplyQuaternions(o,h),e.quaternion.copy(o))}))}},this.show=function(){this.traverse((function(e){(null==t.parent||t.parent.useAllPickers||e.parent!=t.handles)&&(e.visible=!0),e.material&&(e.material.opacity=e.material.oldOpacity),e.parent!=t.pickers&&e.parent!=t.hemiPicker&&e.parent!=t.subPickers||(e.visible=!1),e.parent!=t.planes&&e.parent!=t.highlights||(e.visible=!1)})),this.activePlane.visible=!1},this.highlight=function(e){this.traverse((function(n){n.material&&n.material.highlight&&(n.name==e?(n.parent!=t.highlights&&n.parent!=t.handles||(n.visible=!0),n.material.highlight(!0)):(n.material.highlight(!1),n.material.opacity=.1))}))},this.init()},THREE.TransformGizmoTranslateRotate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoScale=function(){THREE.TransformGizmo.call(this),this.setHandlePickerGizmos=function(){var n=a(.125,.125,.125),i=s("X"),o=s("Y"),r=s("Z");this.handleGizmos={X:[[new THREE.Mesh(n,new e({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(i,new t({color:16711680}))]],Y:[[new THREE.Mesh(n,new e({color:65280})),[0,.5,0]],[new THREE.Line(o,new t({color:65280}))]],Z:[[new THREE.Mesh(n,new e({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(r,new t({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.125,.125,.125),new e({color:16777215,opacity:.25}))]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new e({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new e({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new e({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.4,.4,.4),new e({color:16777215,opacity:.25}))]]}},this.setActivePlane=function(e,t){var n=new THREE.Matrix4;t.applyMatrix4(n.getInverse(n.extractRotation(this.planes.XY.matrixWorld))),"X"==e&&(this.activePlane=this.planes.XY,Math.abs(t.y)>Math.abs(t.z)&&(this.activePlane=this.planes.XZ)),"Y"==e&&(this.activePlane=this.planes.XY,Math.abs(t.x)>Math.abs(t.z)&&(this.activePlane=this.planes.YZ)),"Z"==e&&(this.activePlane=this.planes.XZ,Math.abs(t.x)>Math.abs(t.y)&&(this.activePlane=this.planes.YZ)),"XYZ"==e&&(this.activePlane=this.planes.XYZE),this.hide(),this.show()},this.init()},THREE.TransformGizmoScale.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformControls=function(e,t,n){switch(THREE.Object3D.call(this),t=void 0!==t?t:document,this.gizmo={},n){case"translate":this.gizmo[n]=new THREE.TransformGizmoTranslate;break;case"rotate":this.gizmo[n]=new THREE.TransformGizmoRotate;break;case"transrotate":this.gizmo[n]=new THREE.TransformGizmoTranslateRotate;break;case"scale":this.gizmo[n]=new THREE.TransformGizmoScale}if(this.add(this.gizmo[n]),this.gizmo[n].hide(),this.object=void 0,this.snap=null,this.snapDelta=0,this.space="world",this.size=1,this.axis=null,this.useAllPickers=!0,this.unitX=new THREE.Vector3(1,0,0),this.unitY=new THREE.Vector3(0,1,0),this.unitZ=new THREE.Vector3(0,0,1),this.normal=new THREE.Vector3(0,0,1),"transrotate"===n){(o=new THREE.Geometry).vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1));var i=new THREE.LineBasicMaterial({color:0,linewidth:2,depthTest:!1});this.startLine=new THREE.Line(o,i);var o=new THREE.Geometry;i=new THREE.LineBasicMaterial({color:16770563,linewidth:2,depthTest:!1});o.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1)),this.endLine=new THREE.Line(o,i);o=new THREE.Geometry,i=new THREE.LineDashedMaterial({color:0,linewidth:1,depthTest:!1});o.vertices.push(new THREE.Vector3(0,-1,0),new THREE.Vector3(0,1,0)),this.centerLine=new THREE.Line(o,i),(r=THREE.ImageUtils.loadTexture(Autodesk.Viewing.Private.getResourceUrl("res/textures/centerMarker_X.png"))).magFilter=r.minFilter=THREE.NearestFilter;var r;o=new THREE.CircleGeometry(.1,32),i=new THREE.MeshBasicMaterial({opacity:1,side:THREE.DoubleSide,transparent:!0,map:r});this.centerMark=new THREE.Mesh(o,i),this.centerMark.rotation.set(Math.PI/2,0,0),this.ticks={},(r=THREE.ImageUtils.loadTexture(Autodesk.Viewing.Private.getResourceUrl("res/textures/cardinalPoint.png"))).magFilter=r.minFilter=THREE.NearestFilter;i=new THREE.MeshBasicMaterial({depthTest:!1,opacity:1,transparent:!0,side:THREE.DoubleSide,map:r});var a=.25;this.ticks.RX=new THREE.Object3D;o=new THREE.PlaneBufferGeometry(.12,a);var s=new THREE.Mesh(o,i);s.position.set(0,0,-1.275),s.rotation.set(Math.PI/2,Math.PI/2,0),this.ticks.RX.add(s),(s=s.clone()).position.set(0,1.275,0),s.rotation.set(0,Math.PI/2,0),this.ticks.RX.add(s),(s=s.clone()).position.set(0,0,1.275),s.rotation.set(0,Math.PI/2,Math.PI/2),this.ticks.RX.add(s),(s=s.clone()).position.set(0,-1.275,0),s.rotation.set(0,Math.PI/2,0),this.ticks.RX.add(s),this.ticks.RY=new THREE.Object3D,(s=s.clone()).position.set(0,0,-1.275),s.rotation.set(Math.PI/2,0,0),this.ticks.RY.add(s),(s=s.clone()).position.set(-1.275,0,0),s.rotation.set(Math.PI/2,0,Math.PI/2),this.ticks.RY.add(s),(s=s.clone()).position.set(0,0,1.275),s.rotation.set(Math.PI/2,0,0),this.ticks.RY.add(s),(s=s.clone()).position.set(1.275,0,0),s.rotation.set(Math.PI/2,0,Math.PI/2),this.ticks.RY.add(s)}var c=this,l=!1,h=n,u={type:"change"},E={type:"mouseDown"},p={type:"mouseUp",mode:h},d={type:"objectChange"},m=(new THREE.Raycaster,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3),f=new THREE.Vector3,v=new THREE.Vector3,T=new THREE.Vector3,y=1;this.clientScale=1;var w=new THREE.Matrix4,R=new THREE.Vector3,g=new THREE.Matrix4,H=new THREE.Vector3,x=new THREE.Quaternion,M=new THREE.Vector3,b=new THREE.Vector3,P=new THREE.Vector3,S=new THREE.Quaternion,V=new THREE.Quaternion,z=new THREE.Quaternion,k=new THREE.Quaternion,I=new THREE.Quaternion,A=new THREE.Vector3,G=new THREE.Vector3,B=new THREE.Matrix4,C=new THREE.Matrix4,O=new THREE.Vector3,X=new THREE.Vector3,j=new THREE.Euler,Y=new THREE.Matrix4,L=new THREE.Vector3;new THREE.Euler;function Z(t,n){return THREE.TransformControls.intersectObjects(t.canvasX,t.canvasY,n,e,!0)}this.attach=function(e){c.object=e,this.gizmo[h].show(),c.update(),c.updateUnitVectors()},this.detach=function(e){c.object=void 0,this.axis=null,this.gizmo[h].hide()},this.setMode=function(e){"scale"==(h=e||h)&&(c.space="local"),this.gizmo[h].show(),this.update(),c.dispatchEvent(u)},this.getPicker=function(){return c.gizmo[h].hemiPicker.children},this.setPosition=function(e){this.object.position.copy(e),this.update()},this.setNormal=function(e){x.setFromUnitVectors(this.normal,e),this.unitX.applyQuaternion(x),this.unitY.applyQuaternion(x),this.unitZ.applyQuaternion(x),this.normal.copy(e),this.object&&this.object.quaternion.multiply(x),this.update()},this.setSnap=function(e,t){c.snap=e,c.snapDelta=t},this.setSize=function(e){c.size=e,this.update(),c.dispatchEvent(u)},this.setSpace=function(e){c.space=e,this.update(),c.dispatchEvent(u)},this.update=function(n){if(void 0!==c.object){var i;if(c.object.updateMatrixWorld(),X.setFromMatrixPosition(c.object.matrixWorld),j.setFromRotationMatrix(g.extractRotation(c.object.matrixWorld)),e.updateMatrixWorld(),L.setFromMatrixPosition(e.matrixWorld),this.position.copy(X),this.quaternion.setFromEuler(j),this.normal.set(0,0,1),this.normal.applyEuler(j),e.isPerspective){var o=X.distanceTo(L);i=2*Math.tan(e.fov*Math.PI/360)*o}else i=e.top-e.bottom;var r=t.getBoundingClientRect();y=100*this.clientScale*i/r.height,this.scale.set(y,y,y),this.gizmoOffset&&this.position.add(this.gizmoOffset),this.updateMatrixWorld(),n&&this.gizmo[h].highlight(c.axis)}},this.setGizmoOffset=function(e){this.gizmoOffset=e||new THREE.Vector3(0,0,0),this.update()},this.updateUnitVectors=function(){this.unitX.set(1,0,0),this.unitY.set(0,1,0),this.unitZ.set(0,0,1),this.unitX.applyEuler(j),this.unitY.applyEuler(j),this.unitZ.applyEuler(j)},this.showRotationGizmos=function(e){for(var t=this.gizmo[h].handles.children,n=0;n<t.length;n++){var i=t[n];i.visible=!0,-1!==i.name.search("R")&&(i.visible=e)}this.useAllPickers=e},this.highlight=function(){this.gizmo[h].highlight(this.axis||"Z")},this.onPointerHover=function(e){if(void 0===c.object||!0===l)return!1;var t=Z(e,c.useAllPickers?c.gizmo[h].pickers.children:c.gizmo[h].subPickers.children),n=null,i="";return t&&(i=-1!=(n=t.object.name).search("R")?"rotate":"translate"),c.axis!==n&&(c.axis=n,c.gizmo[h].activeMode=i,c.update(!0),c.dispatchEvent(u)),null===c.axis&&c.gizmo[h].show(),!!t},this.onPointerDown=function(t){if(void 0===c.object||!0===l)return!1;var n=t;if("touch"===t.pointerType){var i=null,o="";(r=Z(n,c.useAllPickers?c.gizmo[h].pickers.children:c.gizmo[h].subPickers.children))&&(o=-1!=(i=r.object.name).search("R")?"rotate":"translate"),c.axis!==i&&(c.axis=i,c.gizmo[h].activeMode=o)}var r=null;if((0===n.button||-1===n.button||void 0===n.button)&&(r=Z(n,c.useAllPickers?c.gizmo[h].pickers.children:c.gizmo[h].subPickers.children))){c.dispatchEvent(E),c.axis=r.object.name,c.update(),R.copy(e.position).sub(X).normalize(),c.gizmo[h].setActivePlane(c.axis,R);var a=Z(n,[c.gizmo[h].activePlane]);if(a&&f.copy(a.point),A.copy(c.object.position),G.copy(c.object.scale),B.extractRotation(c.object.matrix),Y.extractRotation(c.object.matrixWorld),c.object.parent?(C.extractRotation(c.object.parent.matrixWorld),O.setFromMatrixScale(g.getInverse(c.object.parent.matrixWorld))):(C.extractRotation(c.object.matrixWorld),O.setFromMatrixScale(g.getInverse(c.object.matrixWorld))),"transrotate"===h&&"rotate"===c.gizmo[h].activeMode){c.startLine.geometry.vertices[0].set(0,0,0).applyMatrix4(c.matrixWorld),c.startLine.geometry.vertices[1].set(0,0,1).applyMatrix4(c.matrixWorld),c.startLine.geometry.verticesNeedUpdate=!0,c.parent.add(c.startLine);var s=c.object.geometry.getAttribute("position"),u=(new THREE.Vector3).fromAttribute(s,0).applyMatrix4(c.object.matrixWorld),p=(new THREE.Vector3).fromAttribute(s,1).applyMatrix4(c.object.matrixWorld),d=(new THREE.Vector3).fromAttribute(s,2).applyMatrix4(c.object.matrixWorld),m=(new THREE.Vector3).fromAttribute(s,3).applyMatrix4(c.object.matrixWorld);if("RX"===c.axis){u.lerp(d,.5),p.lerp(m,.5);var v=u.distanceTo(p);c.centerLine.material.dashSize=v/15,c.centerLine.material.gapSize=v/30,c.centerLine.geometry.vertices[0].copy(u),c.centerLine.geometry.vertices[1].copy(p)}else{u.lerp(p,.5),d.lerp(m,.5);v=u.distanceTo(d);c.centerLine.material.dashSize=v/15,c.centerLine.material.gapSize=v/30,c.centerLine.geometry.vertices[0].copy(u),c.centerLine.geometry.vertices[1].copy(d)}c.centerLine.geometry.computeLineDistances(),c.centerLine.geometry.verticesNeedUpdate=!0,c.parent.add(c.centerLine),c.ticks[c.axis].position.copy(c.position),c.ticks[c.axis].quaternion.copy(c.quaternion),c.ticks[c.axis].scale.copy(c.scale),c.parent.add(c.ticks[c.axis])}}return l=!0,!!r},this.onPointerMove=function(e){if(void 0===c.object||null===c.axis||!1===l)return!1;var t=Z(e,[c.gizmo[h].activePlane]);t&&m.copy(t.point);var n=c.gizmo[h].activeMode;if("translate"==n)m.sub(f),m.multiply(O),"local"==c.space&&(m.applyMatrix4(g.getInverse(Y)),M.copy(this.unitX),b.copy(this.unitY),P.copy(this.unitZ),H.set(0,0,0),-1!=c.axis.search("X")&&(M.multiplyScalar(m.dot(this.unitX)),H.add(M)),-1!=c.axis.search("Y")&&(b.multiplyScalar(m.dot(this.unitY)),H.add(b)),-1!=c.axis.search("Z")&&(P.multiplyScalar(m.dot(this.unitZ)),H.add(P)),m.copy(H),m.applyMatrix4(B),c.object.position.copy(A),c.object.position.add(m)),"world"!=c.space&&-1==c.axis.search("XYZ")||(M.copy(this.unitX),b.copy(this.unitY),P.copy(this.unitZ),H.set(0,0,0),-1!=c.axis.search("X")&&(M.multiplyScalar(m.dot(this.unitX)),H.add(M)),-1!=c.axis.search("Y")&&(b.multiplyScalar(m.dot(this.unitY)),H.add(b)),-1!=c.axis.search("Z")&&(P.multiplyScalar(m.dot(this.unitZ)),H.add(P)),m.copy(H),m.applyMatrix4(g.getInverse(C)),c.object.position.copy(A),c.object.position.add(m));else if("scale"==n)m.sub(f),m.multiply(O),"local"==c.space&&("XYZ"==c.axis?(y=1+m.y/50,c.object.scale.x=G.x*y,c.object.scale.y=G.y*y,c.object.scale.z=G.z*y):(m.applyMatrix4(g.getInverse(Y)),"X"==c.axis&&(c.object.scale.x=G.x*(1+m.x/50)),"Y"==c.axis&&(c.object.scale.y=G.y*(1+m.y/50)),"Z"==c.axis&&(c.object.scale.z=G.z*(1+m.z/50))));else if("rotate"==n){if(m.sub(X),m.multiply(O),H.copy(f).sub(X),H.multiply(O),"RE"==c.axis){m.applyMatrix4(g.getInverse(w)),H.applyMatrix4(g.getInverse(w)),v.set(Math.atan2(m.z,m.y),Math.atan2(m.x,m.z),Math.atan2(m.y,m.x)),T.set(Math.atan2(H.z,H.y),Math.atan2(H.x,H.z),Math.atan2(H.y,H.x)),x.setFromRotationMatrix(g.getInverse(C));var i=v.z-T.z;if(null!==c.snap){var o=Math.round(i/c.snap)*c.snap;Math.abs(o-i)<c.snapDelta&&(i=o)}I.setFromAxisAngle(R,i),S.setFromRotationMatrix(Y),x.multiplyQuaternions(x,I),x.multiplyQuaternions(x,S),c.object.quaternion.copy(x)}else if("RXYZE"==c.axis){var r=m.clone().cross(H).normalize();x.setFromRotationMatrix(g.getInverse(C));var a=-m.clone().angleTo(H);if(null!==c.snap){o=Math.round(a/c.snap)*c.snap;Math.abs(o-a)<c.snapDelta&&(a=o)}V.setFromAxisAngle(r,a),S.setFromRotationMatrix(Y),x.multiplyQuaternions(x,V),x.multiplyQuaternions(x,S),c.object.quaternion.copy(x)}else if("local"==c.space){m.applyMatrix4(g.getInverse(Y)),H.applyMatrix4(g.getInverse(Y));var s=m.dot(this.unitX),E=m.dot(this.unitY),p=m.dot(this.unitZ),j=H.dot(this.unitX),L=H.dot(this.unitY),_=H.dot(this.unitZ);v.set(Math.atan2(p,E),Math.atan2(s,p),Math.atan2(E,s)),T.set(Math.atan2(_,L),Math.atan2(j,_),Math.atan2(L,j));var D=v.x-T.x,U=v.y-T.y;i=v.z-T.z;if(null!==c.snap){if(-1!=c.axis.search("X")){o=Math.round(D/c.snap)*c.snap;Math.abs(o-D)<c.snapDelta&&(D=o)}if(-1!=c.axis.search("Y")){o=Math.round(U/c.snap)*c.snap;Math.abs(o-U)<c.snapDelta&&(U=o)}if(-1!=c.axis.search("Z")){o=Math.round(i/c.snap)*c.snap;Math.abs(o-i)<c.snapDelta&&(i=o)}}V.setFromAxisAngle(this.unitX,D),z.setFromAxisAngle(this.unitY,U),k.setFromAxisAngle(this.unitZ,i),S.setFromRotationMatrix(B),"RX"==c.axis&&S.multiplyQuaternions(S,V),"RY"==c.axis&&S.multiplyQuaternions(S,z),"RZ"==c.axis&&S.multiplyQuaternions(S,k),c.object.quaternion.copy(S)}else if("world"==c.space){s=m.dot(this.unitX),E=m.dot(this.unitY),p=m.dot(this.unitZ),j=H.dot(this.unitX),L=H.dot(this.unitY),_=H.dot(this.unitZ);v.set(Math.atan2(p,E),Math.atan2(s,p),Math.atan2(E,s)),T.set(Math.atan2(_,L),Math.atan2(j,_),Math.atan2(L,j)),x.setFromRotationMatrix(g.getInverse(C));D=v.x-T.x,U=v.y-T.y,i=v.z-T.z;if(null!==c.snap){if(-1!=c.axis.search("X")){o=Math.round(D/c.snap)*c.snap;Math.abs(o-D)<c.snapDelta&&(D=o)}if(-1!=c.axis.search("Y")){o=Math.round(U/c.snap)*c.snap;Math.abs(o-U)<c.snapDelta&&(U=o)}if(-1!=c.axis.search("Z")){o=Math.round(i/c.snap)*c.snap;Math.abs(o-i)<c.snapDelta&&(i=o)}}V.setFromAxisAngle(this.unitX,D),z.setFromAxisAngle(this.unitY,U),k.setFromAxisAngle(this.unitZ,i),S.setFromRotationMatrix(Y),"RX"==c.axis&&x.multiplyQuaternions(x,V),"RY"==c.axis&&x.multiplyQuaternions(x,z),"RZ"==c.axis&&x.multiplyQuaternions(x,k),x.multiplyQuaternions(x,S),c.object.quaternion.copy(x)}"transrotate"===h&&(c.add(c.endLine),c.add(c.centerMark))}return c.object.matrixAutoUpdate=!0,c.update(!0),c.dispatchEvent(u),c.dispatchEvent(d),!!t},this.onPointerUp=function(e){return l&&null!==c.axis&&(p.mode=h,c.dispatchEvent(p)),l=!1,this.gizmo[h].show(),this.updateUnitVectors(),"transrotate"===h&&"rotate"===this.gizmo[h].activeMode&&(this.remove(this.endLine),this.remove(this.centerMark),this.parent.remove(this.centerLine),this.parent.remove(this.startLine),this.parent.remove(this.ticks[this.axis])),!1}},THREE.TransformControls.intersectObjects=(n=new THREE.Vector3,i=new THREE.Vector3,o=new THREE.Raycaster,function(e,t,r,a,s){var c=e/a.clientWidth*2-1,l=-t/a.clientHeight*2+1;a.isPerspective?(n.set(c,l,.5),n.unproject(a),o.set(a.position,n.sub(a.position).normalize())):(n.set(c,l,-1),n.unproject(a),i.set(0,0,-1),o.set(n,i.transformDirection(a.matrixWorld)));var h=o.intersectObjects(r,s);return h[0]?h[0]:null}),THREE.TransformControls.prototype=Object.create(THREE.Object3D.prototype)}n.r(t);var o=null,r=function(e,t){var n,r,a,s=e.impl,c=["section"],l=!1,h=!1,u=!1,E=!0,p=t.tintColor,d=t.tintIntensity,m=[],f=[],v=[],T="",y="gizmo",w=null,R=!1,g=!0,H=[[0,1],[1,3],[3,2],[2,0]],x=.25,M=2653930;function b(){s.invalidate(!1,!1,!0)}function P(){n&&n.update(),r&&r.update()}function S(){l&&1===f.length&&(G(!0),P(),z((new THREE.Plane).setComponents(f[0].x,f[0].y,f[0].z,f[0].w)))}i(),function(){if(o)return;(o=function(e,t,n){THREE.Mesh.call(this,e,t,!1),this.plane=n,this.planeVec=new THREE.Vector4(n.normal.x,n.normal.y,n.normal.z,n.constant),this.connectivity=[],this.outlines=[]}).prototype=Object.create(THREE.Mesh.prototype),o.prototype.constructor=o,o.prototype.update=function(){this.plane.normal.set(0,0,1),this.plane.normal.applyQuaternion(this.quaternion);var e=this.plane.normal,t=-1*this.getWorldPosition().dot(e);this.planeVec.set(e.x,e.y,e.z,t),this.plane.constant=t}}();var V=new function(e,t){var n,i,o,r,a,c,l,h=0,u=[],E=[];function p(e){h&&clearTimeout(h),h=0,i=e,u.length=0,E.length=0,r=null,a=-1,c=0,l=0}function d(){h=0;for(var r=performance.now()+e;performance.now()<r;){if(!v())return s.invalidate(!0,!0),void p(null);n(E[l],u[c],o,l+1>=E.length,!i||a>=i.length)}h=setTimeout(d,t)}function m(){if(i&&a<i.length)for(;++a<i.length;)if((r=i[a].getInstanceTree())&&(u.length=0,r.enumNodeChildren(i[a].getRootId(),(function(e){u.push(e)}),!0),u.length>0))return o=i[a];return o=null,!1}function f(){if(c>=u.length)return!1;for(;++c<u.length;){var e=u[c];if(!r.isNodeHidden(e)&&!r.isNodeOff(e)&&(E.length=0,r.enumNodeFragments(e,(function(e){E.push(e)}),!1),E.length>0))return!0}return!1}function v(){if(++l<E.length)return!0;for(l=0;;){if(f())return!0;if(!m())return!1;c=-1}}e=e||15,t=t||0,this.start=function(e,t,i){p(e),n=i,i&&(t>=0?h=setTimeout(d,t):d())}};function z(e){var t=Autodesk.Viewing.Extensions.CompGeom;s.sceneAfter.skipDepthTarget=!0,Q();var n=new THREE.Object3D;n.name="section3D",s.scene.add(n);var i=new THREE.Object3D;i.name="section2D",s.sceneAfter.add(i);var o=Autodesk.Viewing.Private,r=t.makePlaneBasis(e),a=(new THREE.Matrix4).getInverse(r),c=s.matman().create2DMaterial(null,{skipCircles:!0,skipEllipticals:!0,isScreenSpace:!0},!1,!1),l=s.matman().findMaterial(null,c);l.transparent=!0,l.depthTest=!0,l.polygonOffset=!0,l.polygonOffsetFactor=-1,l.polygonOffsetUnits=.1,l.cutplanes=I;var h,u=new THREE.Box3,E=s.modelQueue().getModels(),m=[];V.start(E,50,(function(c,E,f,v){var T=f.getFragmentList();if(T.getWorldBounds(c,u),t.xBoxPlane(e,u)){var y=T.getVizmesh(c);y.geometry&&!y.geometry.is2d&&!y.geometry.isLines&&y.material.cutplanes&&(h=y.material,t.xMeshPlane(e,y,m))}if(v){if(m.length){var w=new THREE.Box3;t.convertToPlaneCoords(r,m,w);var R=new o.VertexBufferBuilder(!1,8*m.length),g=function(e){return e&&e.color||new THREE.Color(16777215)}(h),H=0|.25*g.r*255.5,x=0|.25*g.g*255.5,M=4278190080|(0|.25*g.b*255.5)<<16|x<<8|H,b=new t.EdgeSet(m,w,1e-6*w.size().length());b.snapEdges(),b.sanitizeEdges(),b.stitchContours();var P=b.triangulate();if(P){for(var S=0;S<P.contours.length;S++)for(var V=P.contours[S],z=1;z<V.length;z++){var k=P.pts[V[z-1]],A=P.pts[V[z]];R.addSegment(k.x,k.y,A.x,A.y,0,-2,M,E,0)}var G={mesh:R.toMesh()};o.BufferGeometryUtils.meshToGeometry(G);var B=G.geometry;B.streamingDraw=!0,B.streamingIndex=!0;var C=new THREE.Mesh(B,l);if(C.matrix.copy(a),C.matrixAutoUpdate=!1,C.frustumCulled=!1,C.modelId=f.id,C.dbId=E,i.add(C),!P.triangulationFailed){var O=P.toPolygonMesh(h.packedNormals),X=s.matman().cloneMaterial(h,f);X.packedNormals=h.packedNormals,X.cutplanes=I,X.side=THREE.FrontSide,X.depthTest=!0,X.map=null,X.bumpMap=null,X.normalMap=null,X.alphaMap=null,X.specularMap=null,X.transparent=!1,X.depthWrite=!0,X.hatchPattern=!0,X.needsUpdate=!0;var j=(h.id+2)*Math.PI*.125,Y=Math.tan(j);X.hatchParams=new THREE.Vector2(Y,10),X.hatchTintColor=p,X.hatchTintIntensity=d,null!=X.prismType&&(X.defines={},X.defines[X.prismType.toUpperCase()]="","PrismWood"==X.prismType&&(X.defines.NO_UVW=""));var L=new THREE.Mesh(O,X);L.matrix.copy(a),L.matrixAutoUpdate=!1,L.modelId=f.id,L.dbId=E,L.fragId=m.fragId,n.add(L)}}}m.length=0}}))}var k="Autodesk.Viewing.Extension.Section.SectionTool";s.setCutPlaneSetFor2DRendering(k);var I=[];function A(e,t){var n,i,r=(new THREE.Quaternion).setFromUnitVectors(new THREE.Vector3(0,0,1),e.normal);if(t){var a=e.projectPoint(t.max),c=e.projectPoint(t.min),l=r.clone().inverse();a.applyQuaternion(l),c.applyQuaternion(l),i=(new THREE.Vector3).subVectors(a,c),n=new THREE.PlaneBufferGeometry(i.x,i.y)}else i=2*(t=s.getVisibleBounds()).getBoundingSphere().radius,n=new THREE.PlaneBufferGeometry(i,i);var h=new THREE.MeshBasicMaterial({opacity:0,color:M,side:THREE.DoubleSide,depthTest:!1,depthWrite:!1,transparent:!0}),u=new o(n,h,e),E=e.projectPoint(t.center());u.position.copy(E),u.quaternion.multiply(r);var p=s.currentLightPreset();p=Math.max(0,p);for(var d=Autodesk.Viewing.Private.LightPresets[p].bgColorGradient,m="rgb("+(255-d[0])+","+(255-d[1])+","+(255-d[2])+")",f=new THREE.LineBasicMaterial({color:m,linewidth:1,depthTest:!1}),v=u.geometry.getAttribute("position"),T=0;T<H.length;T++){(n=new THREE.Geometry).vertices.push((new THREE.Vector3).fromArray(v.array,H[T][0]*v.itemSize),(new THREE.Vector3).fromArray(v.array,H[T][1]*v.itemSize));var y=new THREE.Line(n,f);u.add(y),u.outlines.push(y)}return u}function G(e){B((function(t){var n,i,r,a;if(t instanceof o)if(t.connectivity.length>0){var c=(new THREE.Matrix4).getInverse(t.matrixWorld);for(a=new THREE.Vector3,r=t.geometry.getAttribute("position"),n=0;n<r.length/r.itemSize;n++){var l=t.connectivity[n];null!==N(t.plane,l[0],l[1],a)&&(a.applyMatrix4(c),r.setXYZ(n,a.x,a.y,a.z))}for(r.needsUpdate=!0,t.geometry.computeBoundingBox(),t.geometry.computeBoundingSphere(),n=0;n<t.outlines.length;n++)(i=t.outlines[n]).geometry.vertices[0].fromArray(r.array,H[n][0]*r.itemSize),i.geometry.vertices[1].fromArray(r.array,H[n][1]*r.itemSize),i.geometry.verticesNeedUpdate=!0}else if(e){var h=s.getVisibleBounds(),u=2*h.getBoundingSphere().radius;for(a=t.plane.projectPoint(h.center()),t.geometry=new THREE.PlaneBufferGeometry(u,u),t.position.copy(a),r=t.geometry.getAttribute("position"),n=0;n<t.outlines.length;n++)(i=t.outlines[n]).geometry.vertices[0].fromArray(r.array,H[n][0]*r.itemSize),i.geometry.vertices[1].fromArray(r.array,H[n][1]*r.itemSize),i.geometry.verticesNeedUpdate=!0}}))}function B(e){for(var t=0;t<m.length;t++)m[t].traverse(e)}function C(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];B((function(e){e instanceof o&&e.update()})),1===f.length&&z((new THREE.Plane).setComponents(f[0].x,f[0].y,f[0].z,f[0].w)),s.setCutPlaneSet(k,f,e)}function O(e){for(var t=0;t<m.length;t++)m[t].visible=e;E!==e&&b(),E=e}function X(e){e&&f.length>0&&(1===f.length&&z((new THREE.Plane).setComponents(f[0].x,f[0].y,f[0].z,f[0].w)),s.setCutPlaneSet(k,f)),O(e)}function j(e,t){e.attach(t),e.setPosition(t.position),e.visible=!0}function Y(e){return s.api.navigation.getEyeVector().dot(e)>0&&e.negate(),e}function L(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=s.getVisibleBounds().center(),r=new THREE.Group;t=void 0!==t?t:-1*o.dot(e);var a=A(new THREE.Plane(e,t),null);r.add(a),f.push(a.planeVec),m.push(r),s.addOverlay(y,r),n&&(j(n,a),a.material.opacity=x,Z(a),n.showRotationGizmos(!0),v=n.getPicker()),C(i)}function Z(e){if(!n||!e)return!1;var t=function(e){var t=new THREE.Vector3,n=e.geometry;return n.computeBoundingBox(),t.x=(n.boundingBox.max.x+n.boundingBox.min.x)/2,t.y=(n.boundingBox.max.y+n.boundingBox.min.y)/2,t.z=(n.boundingBox.max.z+n.boundingBox.min.z)/2,e.localToWorld(t),t}(e).sub(e.position);return t.sub(a),n.setGizmoOffset(t),!0}var _,D,U,F,N=(_=new THREE.Matrix3,D=new THREE.Vector3,U=new THREE.Vector3,F=new THREE.Vector3,function(e,t,n,i){_.set(e.normal.x,e.normal.y,e.normal.z,t.normal.x,t.normal.y,t.normal.z,n.normal.x,n.normal.y,n.normal.z);var o=_.determinant();return 0===o?null:(D.crossVectors(t.normal,n.normal).multiplyScalar(-e.constant),U.crossVectors(n.normal,e.normal).multiplyScalar(-t.constant),F.crossVectors(e.normal,t.normal).multiplyScalar(-n.constant),(i||new THREE.Vector3).copy(D).add(U).add(F).divideScalar(o))}),W=function(e,t,n){return THREE.TransformControls.intersectObjects(e.canvasX,e.canvasY,t,s.camera,n)};function Q(){var e=s.scene.getObjectByName("section3D");e&&s.scene.remove(e);var t=s.sceneAfter.getObjectByName("section2D");t&&s.sceneAfter.remove(t)}this.isActive=function(){return l},this.getSectionDistance=function(e){var t=s.api.navigation.getEyeVector(),n=s.rayIntersect(new THREE.Ray(s.camera.position,t));return n&&n.intersectPoint&&-1*n.intersectPoint.dot(e)},this.setViewerSection=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.clearSection(e);var t=s.getCutPlaneSet("__set_view");if(1===t.length){n.clientScale=1;var i=t[0],o=new THREE.Vector3(i.x,i.y,i.z),r=i.w;L(o,r,e),T="SET_VIEW_PLANE",s.setCutPlaneSet("__set_view",void 0,e)}},this.setSection=function(e){var t,i;this.clearSection(),a=new THREE.Vector3,n.clientScale=1;var o=s.getCutPlaneSet("__set_view");switch(1===o.length&&"BOX"!==e&&"OBJ_SET_VIEW_PLANE"!==e&&(e="SET_VIEW_PLANE"),e){case"X":t=new THREE.Vector3(1,0,0),i=this.getSectionDistance(t),L(Y(t),i);break;case"Y":t=new THREE.Vector3(0,1,0),i=this.getSectionDistance(t),L(Y(t),i);break;case"Z":t=new THREE.Vector3(0,0,1),i=this.getSectionDistance(t),L(Y(t),i);break;case"OBJ_SET_VIEW_PLANE":case"SET_VIEW_PLANE":var c=o[0];L(t=new THREE.Vector3(c.x,c.y,c.z),c.w);break;case"OBJ_BOX":case"BOX":!function(e){var t=[new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1),new THREE.Vector3(-1,0,0),new THREE.Vector3(0,-1,0),new THREE.Vector3(0,0,-1)],i=[[[1,2],[1,5],[2,4],[4,5]],[[3,5],[0,5],[2,3],[0,2]],[[1,3],[0,1],[3,4],[0,4]],[[1,5],[1,2],[4,5],[2,4]],[[2,3],[0,2],[3,5],[0,5]],[[0,1],[3,1],[0,4],[3,4]]],o=new THREE.Group,a=s.getVisibleBounds(),c=a.center(),l=new THREE.Box3(a.min,c),h=!1;e&&6===e.length&&1===e[0].x&&(c=(l=new THREE.Box3(new THREE.Vector3(e[3].w,e[4].w,e[5].w),new THREE.Vector3(e[0].w,e[1].w,e[2].w))).max.clone(),h=!0);var u,E,p=[],d=[];for(u=0;u<t.length;u++){if(h){var T=new THREE.Plane(t[u],e[u].w);p.push(T)}else{T=new THREE.Plane(t[u],-1*c.dot(t[u]));if(p.push(T),u>2){var w=T.orthoPoint(l.max),R=T.orthoPoint(l.min),g=(new THREE.Vector3).subVectors(w,R);T.constant-=g.length()}}E=A(T,l),o.add(E),d.push(E),f.push(E.planeVec)}for(u=0;u<d.length;u++){E=d[u];for(var H=i[u],M=0;M<H.length;M++){for(var b=[],P=H[M],S=0;S<P.length;S++)b.push(p[P[S]]);E.connectivity.push(b)}}m.push(o),s.addOverlay(y,o),C(),G(),T=m[0].children[0],j(n,T),T.material.opacity=x,Z(T),j(r,m[0]),n.showRotationGizmos(!1),v=n.getPicker().concat(r.getPicker());var V=m[0].position.clone().sub(c.clone());r.setGizmoOffset(V)}(o),n.clientScale=2,this.recomputePivot()}T=e,s.setCutPlaneSet("__set_view",void 0)},this.setSectionFromPlane=function(e){this.clearSection(),L(new THREE.Vector3(e.x,e.y,e.z),e.w),T="",s.setCutPlaneSet("__set_view",void 0)},this.setActiveMode=function(e){T=e||""},this.clearSection=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(n&&n.detach(),r&&r.detach();f.length>0;)f.pop();for(;m.length>0;){var t=m.pop();s.removeOverlay(y,t)}V.start(null),Q(),s.setCutPlaneSet(k,null,e)},this.isPlaneOn=function(){return E},this.showPlane=function(e){O(e)},this.attachControl=function(e){n&&r&&(e?(j(n,m[0].children[0]),n.highlight(),"BOX"===T&&j(r,m[0])):(n.detach(),r.detach()))},this.resetSection=function(){this.setSection(T)},this.getNames=function(){return c},this.getName=function(){return c[0]},this.register=function(){},this.deregister=function(){this.clearSection(),R&&(s.removeOverlay(y,n),n.removeEventListener("change",b),n=null,s.removeOverlay(y,r),r.removeEventListener("change",b),r=null,s.removeOverlayScene(y),e.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,P),e.removeEventListener(Autodesk.Viewing.ISOLATE_EVENT,S),e.removeEventListener(Autodesk.Viewing.HIDE_EVENT,S),e.removeEventListener(Autodesk.Viewing.SHOW_EVENT,S),R=!1)},this.getPriority=function(){return 70},this.activate=function(){R||((n=new THREE.TransformControls(s.camera,s.canvas,"transrotate")).addEventListener("change",b),n.setSnap(Math.PI/2,Math.PI/36),(r=new THREE.TransformControls(s.camera,s.canvas,"translate")).addEventListener("change",b),void 0===s.overlayScenes[y]&&s.createOverlayScene(y),s.addOverlay(y,n),s.addOverlay(y,r),e.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,P),e.addEventListener(Autodesk.Viewing.ISOLATE_EVENT,S),e.addEventListener(Autodesk.Viewing.HIDE_EVENT,S),e.addEventListener(Autodesk.Viewing.SHOW_EVENT,S),R=!0),l=!0,h=!1,g=!0,f=f||[],X(!0)},this.deactivate=function(){l=!1,h=!1,V.start(null),Q(),X(!1),s.setCutPlaneSet(k),n.detach(),r.detach()},this.update=function(){return!1},this.handleSingleClick=function(e){var t=W(e,m[0].children);return m[0].children.forEach((function(e){e.material.opacity=0})),t&&(j(n,t.object),n.highlight(),t.object.material.opacity=x,Z(t.object),b()),!1},this.handleDoubleClick=function(){return!1},this.handleSingleTap=function(e){return this.handleSingleClick(e,0)},this.handleDoubleTap=function(){return!1},this.handleKeyDown=function(){return!1},this.handleKeyUp=function(){return!1},this.handleWheelInput=function(){return!1},this.handleButtonDown=function(e){return h=!0,!!r.onPointerDown(e)||n.onPointerDown(e)},this.handleButtonUp=function(e){return h=!1,u&&(u=!1,this.recomputePivot()),!!r.onPointerUp(e)||n.onPointerUp(e)},this.handleMouseMove=function(e){var t=r.object?(new THREE.Vector3).copy(r.object.position):null;if(h){if(r.onPointerMove(e)){u=!0,C(),n.update();var i=(new THREE.Vector3).copy(r.object.position).sub(t);return a.add(i),!0}if(n.onPointerMove(e))return u=!0,C(),G(),!0}if(r.visible=void 0!==r.object,"touch"!==e.pointerType){var o=e,s=W(o,m[0].children);s&&(g=!1);var c=!!(g||s||W(o,v,!0));n.visible=c,r.visible=r.visible&&c,O(c)}return!!r.onPointerHover(e)||n.onPointerHover(e)},this.handleGesture=function(e){switch(e.type){case"dragstart":return w="drag",this.handleButtonDown(e,0);case"dragmove":return"drag"===w&&this.handleMouseMove(e);case"dragend":return"drag"===w&&(w=null,this.handleButtonUp(e,0))}return!1},this.handleBlur=function(){return!1},this.handleResize=function(){},this.handlePressHold=function(){return!0},this.recomputePivot=function(){var e=this.getSectionBoxValues(!0);if(e){var t=e.sectionBox;s.api.navigation.setPivotPoint(new THREE.Vector3(t[0]+.5*(t[3]-t[0]),t[1]+.5*(t[4]-t[1]),t[2]+.5*(t[5]-t[2])))}},this.getSectionBoxValues=function(e){var t=m[0];if(!t)return null;var n=t.children;if(n.length<6)return null;var i=n[0].position.x,o=n[1].position.y,r=n[2].position.z,a=n[3].position.x,c=n[4].position.y,l=n[5].position.z,h={x:0,y:0,z:0};return e||(h=s.model.getData().globalOffset||h),{sectionBox:[Math.min(a,i)+h.x,Math.min(o,c)+h.y,Math.min(r,l)+h.z,Math.max(a,i)+h.x,Math.max(o,c)+h.y,Math.max(r,l)+h.z],sectionBoxTransform:(new THREE.Matrix4).identity().toArray()}},this.getSectionPlaneValues=function(e){var t=m[0];if(!t)return null;var n=t.children;if(1!==n.length)return null;var i={x:0,y:0,z:0};e||(i=s.model.getData().globalOffset||i);var o=n[0].plane,r=o.constant-THREE.Vector3.prototype.dot.call(i,o.normal);return{sectionPlane:[o.normal.x,o.normal.y,o.normal.z,r]}},this.getSectionPlaneSet=function(){return s.getCutPlaneSet(k)},this.getSectionPlanes=function(){var e=s.getCutPlaneSet("__set_view");return e.length>0?e:s.getCutPlaneSet(k)},this.notifyCutplanesChanged=function(){var e=I.length;I.length=0;for(var t=s.getCutPlaneSets(),n=0;n<t.length;n++){var i=t[n];if(i!==k)for(var o=s.getCutPlaneSet(i),r=0;r<o.length;r++)I.push(o[r])}t.includes("__set_view")&&""!==T&&-1===T.indexOf("OBJ_")&&this.setViewerSection(!1),e!==I.length&&function(){function e(e){e&&e.traverse((function(e){!e instanceof THREE.Mesh||!e.material||(e.material.needsUpdate=!0)}))}e(s.scene.getObjectByName("section3D")),e(s.sceneAfter.getObjectByName("section2D"))}()},this.setSectionBox=function(e){if(!e)return!1;var t=Autodesk.Viewing.Private.SceneMath.box2CutPlanes(e,e.transform);return T="OBJ_BOX",s.setCutPlaneSet("__set_view",t),this.setSection("OBJ_BOX"),!0},this.setSectionPlane=function(e,t){if(!e||!t)return!1;var n="OBJ_SET_VIEW_PLANE",i=-1*t.dot(e),o=new THREE.Plane(e,i);T=n;var r=[new THREE.Vector4(o.normal.x,o.normal.y,o.normal.z,o.constant)];return s.setCutPlaneSet("__set_view",r),this.setSection(n),!0}};n(307);n.d(t,"SectionExtension",(function(){return a}));var a=function(e,t){Autodesk.Viewing.Extension.call(this,e,t),this.viewer=e,this.name="section",this.modes=["x","y","z","box"],this.onViewerSetView=this.onViewerSetView.bind(this),this._onCutPlanesChanged=this._onCutPlanesChanged.bind(this),this._onShowAll=this._onShowAll.bind(this)};a.prototype=Object.create(Autodesk.Viewing.Extension.prototype),a.prototype.constructor=a;var s=a.prototype;s.load=function(){var e=this,t=this,n=this.viewer;this.tool=new r(n,{tintColor:{r:1,g:1,b:0},tintIntensity:.2}),n.toolController.registerTool(this.tool),this.sectionStyle=null,this.supportedStyles=["X","Y","Z","BOX"],n.addEventListener(Autodesk.Viewing.SET_VIEW_EVENT,this.onViewerSetView),n.addEventListener(Autodesk.Viewing.CUTPLANES_CHANGE_EVENT,this._onCutPlanesChanged),n.addEventListener(Autodesk.Viewing.SHOW_ALL_EVENT,this._onShowAll),this.HOTKEYS_ID="Autodesk.Section.Hotkeys";var i=[{keycodes:[Autodesk.Viewing.KeyCode.ESCAPE],onRelease:function(){return t.deactivate()}}];return n.getHotkeyManager().pushHotkeys(this.HOTKEYS_ID,i),this.viewer.registerContextMenuCallback("Autodesk.Section",(function(t,n){!function(e,t,n){if(!n.hasSelected)return;var i=e.viewer,o=(n.event,i.impl.selector.getSelectionBounds());t.push({title:"Section Box",target:e.setSectionBox.bind(e,o)});var r=i.getSelection(),a=i.impl.hitTest(n.canvasX,n.canvasY,!1,r);a&&-1!==r.indexOf(a.dbId)&&t.push({title:"Section Plane",target:e.setSectionPlane.bind(e,a.face.normal,a.point)})}(e,t,n)})),this.viewer.loadExtension("Autodesk.CompGeom")},s.unload=function(){var e=this.viewer;return e.unregisterContextMenuCallback("Autodesk.Section"),e.getHotkeyManager().popHotkeys(this.HOTKEYS_ID),this.destroyUI(),e.removeEventListener(Autodesk.Viewing.SET_VIEW_EVENT,this.onViewerSetView),e.removeEventListener(Autodesk.Viewing.CUTPLANES_CHANGE_EVENT,this._onCutPlanesChanged),e.removeEventListener(Autodesk.Viewing.SHOW_ALL_EVENT,this._onShowAll),e.toolController.deregisterTool(this.tool),this.tool=null,!0},s.toggle=function(){if(this.isActive())this.enableSectionTool(!1);else{var e=this.sectionStyle||"X";this.setSectionStyle(e,!0)}return this.isActive()},s.getSectionStyle=function(){return this.sectionStyle},s.setSectionStyle=function(e,t){if(-1===this.supportedStyles.indexOf(e))return!1;var n=this.isActive(),i=this.sectionStyle!==e||!t;return this.sectionStyle=e,n&&i?this.tool.setSection(e):n||(this.enableSectionTool(!0),i?this.tool.setSection(e):this.tool.attachControl(!0)),!0},s.setSectionFromPlane=function(e){if(this.deactivate(),e)this.tool.setSectionFromPlane(e),this.tool.attachControl(!1),this.isActive()||this.tool.showPlane(!1);else{this.tool.clearSection();var t=this.viewer.toolController.setIsLocked(!1);this.enableSectionTool(!1),this.viewer.toolController.setIsLocked(t)}},s.getSectionPlanes=function(){return this.tool.getSectionPlanes()},s.enableSectionTool=function(e){var t=this.viewer.toolController,n=this.tool.isActive();return e&&!n?(t.activateTool("section"),this.sectionToolButton&&this.sectionToolButton.setState(Autodesk.Viewing.UI.Button.State.ACTIVE),!0):!(e||!n)&&(t.deactivateTool("section"),this.sectionToolButton&&this.sectionToolButton.setState(Autodesk.Viewing.UI.Button.State.INACTIVE),!0)},s.getViewValues=function(e){var t=this.tool.getSectionBoxValues(e);if(t)return t;var n=this.tool.getSectionPlaneValues(e);return n||null},s.getState=function(e){if(this.viewer.model&&!this.viewer.model.is2d()){e.cutplanes=e.cutplanes||[];for(var t=this.tool.getSectionPlaneSet(),n=0;n<t.length;n++)e.cutplanes.push(t[n].toArray())}},s.restoreState=function(e,t){var n=this.getSectionPlanes();return this.setSectionFromPlane(null),1===n.length&&this.setSectionFromPlane(n[0]),!0},s._onCutPlanesChanged=function(){this.tool.notifyCutplanesChanged()},s._onShowAll=function(){this.deactivate()},s.setSectionBox=function(e){e&&(this.enableSectionTool(!0),this.tool.setSectionBox(e)?(this.activeStatus=!0,this.viewer.clearSelection()):this.enableSectionTool(!1))},s.setSectionPlane=function(e,t){e&&t&&(this.enableSectionTool(!0),this.tool.setSectionPlane(e,t)?(this.activeStatus=!0,this.viewer.clearSelection()):this.enableSectionTool(!1))},s.onViewerSetView=function(){this.deactivate()},s.onToolbarCreated=function(e){var t=Autodesk.Viewing.UI;this.sectionToolButton=new t.ComboButton("toolbar-sectionTool"),this.sectionToolButton.setToolTip("Section analysis"),this.sectionToolButton.setIcon("adsk-icon-section-analysis"),this.createSubmenu(this.sectionToolButton);var n=e.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID);if(n){var i=n.getControl("toolbar-resetTool");i?n.addControl(this.sectionToolButton,{index:n.indexOf(i.getId())}):n.addControl(this.sectionToolButton,{index:0})}},s.createSubmenu=function(e){var t=this,n=this.viewer,i=Autodesk.Viewing.UI;function o(e,n){return function(){var o=e.getState(),r=function(){e instanceof i.ComboButton==!1?t.activate(n):(t.enableSectionTool(!0),t.tool.attachControl(!0))};o===i.Button.State.INACTIVE?(e.setState(i.Button.State.ACTIVE),Autodesk.Viewing.isMobileDevice()?setTimeout(r,1):r()):o===i.Button.State.ACTIVE&&(e.setState(i.Button.State.INACTIVE),t.deactivate()),t.sectionStyle=n.toUpperCase()}}var r=this.sectionXButton=new i.Button("toolbar-sectionTool-x");r.setToolTip("Add X plane"),r.setIcon("adsk-icon-plane-x"),r.onClick=o(r,"x"),e.addControl(r);var a=this.sectionYButton=new i.Button("toolbar-sectionTool-y");a.setToolTip("Add Y plane"),a.setIcon("adsk-icon-plane-y"),a.onClick=o(a,"y"),e.addControl(a);var s=this.sectionZButton=new i.Button("toolbar-sectionTool-z");s.setToolTip("Add Z plane"),s.setIcon("adsk-icon-plane-z"),s.onClick=o(s,"z"),e.addControl(s);var c=this.sectionBoxButton=new i.Button("toolbar-sectionTool-box");c.setToolTip("Add box"),c.setIcon("adsk-icon-box"),c.onClick=o(c,"box"),e.addControl(c),n.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,(function e(){var i,o=(i=new THREE.Vector3,function(e,t,n){return i.subVectors(e,t),i.lengthSq()<n}),r=new THREE.Vector3(1,0,0),a=new THREE.Vector3(0,1,0),s=new THREE.Vector3(0,0,1),c=n.autocam.getWorldRightVector(),l=n.autocam.getWorldUpVector(),h=n.autocam.getWorldFrontVector();o(l,r,1e-4)?t.sectionYButton.setIcon("adsk-icon-plane-x"):o(l,s,1e-4)?t.sectionYButton.setIcon("adsk-icon-plane-z"):t.sectionYButton.setIcon("adsk-icon-plane-y"),o(c,a,1e-4)?t.sectionXButton.setIcon("adsk-icon-plane-y"):o(c,s,1e-4)?t.sectionXButton.setIcon("adsk-icon-plane-z"):t.sectionXButton.setIcon("adsk-icon-plane-x"),o(h,r,1e-4)?t.sectionZButton.setIcon("adsk-icon-plane-x"):o(h,a,1e-4)?t.sectionZButton.setIcon("adsk-icon-plane-y"):t.sectionZButton.setIcon("adsk-icon-plane-z"),n.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,e)}))},s.destroyUI=function(){this.sectionToolButton&&(this.sectionToolButton.removeFromParent(),this.sectionToolButton=null)},s.activate=function(e){if(!this.activeStatus||this.mode!==e){switch(this.enableSectionTool(!0),e){default:case"x":this.tool.setSection("X"),this.mode="x";break;case"y":this.tool.setSection("Y"),this.mode="y";break;case"z":this.tool.setSection("Z"),this.mode="z";break;case"box":this.tool.setSection("BOX"),this.mode="box"}return this.activeStatus=!0,!0}},s.deactivate=function(){return!!this.activeStatus&&(this.tool.setActiveMode(""),this.enableSectionTool(!1),this.activeStatus=!1,!0)},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Section",a)}});
//# sourceMappingURL=Section.min.js.map